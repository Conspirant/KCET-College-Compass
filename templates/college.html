<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KCET College Compass | Engineering Admission Analytics</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <!-- Add Select2 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    
    <!-- Add Bootstrap JavaScript and Popper.js -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Add Select2 JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #3498db;
            --text-color: #2c3e50;
            --border-radius: 12px;
            --transition-speed: 0.3s;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            position: relative;
        }

        .container {
            max-width: 1200px;
            padding: 2rem;
            margin-top: 0;
        }

        .header-section {
            text-align: center;
            margin-bottom: 3rem;
            animation: fadeInDown 1s ease;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
            padding: 2rem;
            border-radius: var(--border-radius);
        }

        .header-section h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .header-section p {
            font-size: 1.1rem;
            color: var(--secondary-color);
            max-width: 800px;
            margin: 0 auto;
        }

        /* Disclaimer Styles */
        .disclaimer-section {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.8));
            border-radius: var(--border-radius);
            border-left: 5px solid #e74c3c;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
            animation: pulseAttention 2s infinite;
        }

        .disclaimer-section::before {
            content: "‚ö†Ô∏è";
            position: absolute;
            top: -15px;
            right: -15px;
            font-size: 6rem;
            opacity: 0.1;
            transform: rotate(15deg);
        }

        .disclaimer-title {
            color: #e74c3c;
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .disclaimer-content {
            font-size: 0.95rem;
            color: #2c3e50;
            line-height: 1.6;
        }

        .disclaimer-points {
            list-style: none;
            padding: 0;
            margin: 1rem 0;
        }

        .disclaimer-points li {
            padding-left: 1.5rem;
            position: relative;
            margin-bottom: 0.5rem;
        }

        .disclaimer-points li::before {
            content: "‚Ä¢";
            color: #e74c3c;
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        @keyframes pulseAttention {
            0% { box-shadow: 0 4px 15px rgba(231, 76, 60, 0.1); }
            50% { box-shadow: 0 4px 25px rgba(231, 76, 60, 0.2); }
            100% { box-shadow: 0 4px 15px rgba(231, 76, 60, 0.1); }
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: var(--border-radius);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            margin-bottom: 2rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            padding: 2rem;
            animation: fadeInUp 1s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }

        .form-control, .form-select {
            border-radius: var(--border-radius);
            border: 2px solid #e0e0e0;
            padding: 0.75rem;
            transition: all var(--transition-speed) ease;
            background: rgba(255, 255, 255, 0.9);
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 0.25rem rgba(52, 152, 219, 0.25);
            transform: translateY(-2px);
        }

        .btn-primary {
            background-color: var(--accent-color);
            border: none;
            border-radius: var(--border-radius);
            padding: 0.75rem 2rem;
            font-weight: 600;
            transition: all var(--transition-speed) ease;
            width: auto;
            position: relative;
            overflow: hidden;
        }

        .btn-primary:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            animation: buttonPulse 1.5s infinite;
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .table {
            border-radius: var(--border-radius);
            overflow: hidden;
            background: white;
            animation: fadeIn 1s ease;
        }

        .table thead th {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            border: none;
            padding: 1rem;
            font-weight: 600;
        }

        .table tbody tr {
            transition: all 0.3s ease;
        }

        .table tbody tr:hover {
            background-color: rgba(52, 152, 219, 0.05);
            transform: scale(1.01);
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(8px);
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 6px solid var(--secondary-color);
            border-top: 6px solid var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .form-section {
            background: rgba(255, 255, 255, 0.8);
            padding: 2rem;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
            animation: fadeInUp 0.8s ease;
        }

        .results-section {
            animation: fadeInUp 1s ease;
        }

        .status-badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            display: inline-block;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .status-badge.likely {
            background-color: rgba(46, 204, 113, 0.2);
            color: #27ae60;
        }

        .status-badge.unlikely {
            background-color: rgba(231, 76, 60, 0.2);
            color: #c0392b;
        }

        .status-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .form-label {
            font-weight: 600;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            transition: transform var(--transition-speed) ease;
        }

        .form-label i {
            color: var(--accent-color);
            transition: transform var(--transition-speed) ease;
        }

        .form-group:hover .form-label {
            transform: translateX(5px);
        }

        .form-group:hover .form-label i {
            transform: scale(1.2);
            color: var(--accent-color);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .alert {
            border-radius: var(--border-radius);
            margin-top: 1rem;
            animation: fadeIn 0.5s ease;
        }

        /* Add these new styles */
        .course-group {
            margin-bottom: 0.5rem;
        }

        .course-group-label {
            font-weight: 600;
            color: var(--primary-color);
            padding: 0.5rem 1rem;
            background: rgba(52, 152, 219, 0.1);
            border-radius: var(--border-radius);
        }

        .course-option {
            padding-left: 1.5rem !important;
        }

        .course-code {
            font-weight: 600;
            color: var(--accent-color);
        }

        .course-description {
            font-size: 0.85rem;
            color: #666;
            display: block;
            margin-top: 0.2rem;
        }

        /* Enhance form controls */
        .form-select {
            padding-right: 2.5rem;
            background-position: right 1rem center;
        }

        /* Add pulsing effect to the submit button */
        @keyframes buttonPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .btn-primary:hover {
            animation: buttonPulse 1.5s infinite;
        }

        /* Enhance card transitions */
        .card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }

        /* Add subtle gradient to header */
        .header-section {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
            padding: 2rem;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
        }

        /* Enhance table appearance */
        .table thead th {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            color: white;
            border: none;
        }

        .table tbody tr {
            transition: all 0.3s ease;
        }

        .table tbody tr:hover {
            background-color: rgba(52, 152, 219, 0.05);
            transform: scale(1.01);
        }

        /* Add shadow to status badges */
        .status-badge {
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .status-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .results-stats {
            background: rgba(52, 152, 219, 0.9) !important;
            color: white !important;
            padding: 1rem !important;
            border-radius: var(--border-radius);
            text-align: center;
            min-width: 150px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .results-stats .total-colleges-count {
            font-size: 2.5rem;
            font-weight: bold;
            line-height: 1;
            color: white;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
        }

        .results-stats .label {
            font-size: 0.9rem;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        @media (max-width: 576px) {
            .container {
                padding: 1rem;
            }
            .card {
                padding: 1rem;
            }
            .btn-primary {
                width: 100%;
            }
            .header-section h1 {
                font-size: 2rem;
            }

            /* Mobile Optimizations */
            .header-section {
                margin-bottom: 1.5rem;
            }

            .header-section p {
                font-size: 1rem;
                padding: 0 1rem;
            }

            .disclaimer-section {
                margin: 0.5rem;
                padding: 1rem;
                font-size: 0.9rem;
            }

            .disclaimer-section::before {
                font-size: 4rem;
                top: -10px;
                right: -10px;
            }

            .disclaimer-title {
                font-size: 1.1rem;
            }

            .disclaimer-content {
                font-size: 0.9rem;
            }

            .disclaimer-points li {
                margin-bottom: 0.75rem;
                line-height: 1.4;
            }

            .form-section {
                padding: 1rem;
                margin: 0.5rem;
            }

            .form-label {
                font-size: 0.95rem;
            }

            .form-control, .form-select {
                font-size: 0.95rem;
                padding: 0.5rem;
            }

            .form-check-label {
                font-size: 0.9rem;
                line-height: 1.3;
            }

            .table {
                font-size: 0.9rem;
            }

            .table td, .table th {
                padding: 0.5rem;
            }

            /* Make table scrollable horizontally on mobile */
            .table-responsive {
                margin: 0 -1rem;
                padding: 0 1rem;
                width: calc(100% + 2rem);
            }

            /* Adjust status badges for mobile */
            .status-badge {
                padding: 0.25rem 0.75rem;
                font-size: 0.85rem;
            }

            /* Improve form spacing on mobile */
            .mb-3 {
                margin-bottom: 0.75rem !important;
            }

            .mb-4 {
                margin-bottom: 1rem !important;
            }

            /* Make loading overlay more visible on mobile */
            .loading-overlay {
                background: rgba(255, 255, 255, 0.95);
            }

            .loading-spinner {
                width: 40px;
                height: 40px;
                border-width: 4px;
            }

            /* Improve button appearance on mobile */
            .btn-primary {
                padding: 0.75rem 1rem;
                font-size: 1rem;
                margin-top: 0.5rem;
            }

            /* Adjust card shadow for better mobile visibility */
            .card {
                box-shadow: 0 4px 15px rgba(31, 38, 135, 0.1);
            }

            .card:hover {
                transform: none;
                box-shadow: 0 4px 15px rgba(31, 38, 135, 0.1);
            }

            /* Optimize animations for mobile */
            @keyframes pulseAttention {
                0% { box-shadow: 0 2px 8px rgba(231, 76, 60, 0.1); }
                50% { box-shadow: 0 2px 12px rgba(231, 76, 60, 0.2); }
                100% { box-shadow: 0 2px 8px rgba(231, 76, 60, 0.1); }
            }
        }

        /* Add styles for medium-sized devices */
        @media (min-width: 577px) and (max-width: 768px) {
            .container {
                padding: 1.5rem;
            }

            .header-section h1 {
                font-size: 2.2rem;
            }

            .disclaimer-section {
                margin: 1rem;
                padding: 1.25rem;
            }

            .form-section {
                padding: 1.5rem;
            }

            .table td, .table th {
                padding: 0.75rem;
            }
        }

        /* Optimize table for all screen sizes */
        @media (max-width: 992px) {
            .table-responsive {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .table {
                min-width: 800px;
            }

            /* Add horizontal scroll indicator */
            .table-responsive::after {
                content: "‚ü∑ Scroll horizontally to view more";
                display: block;
                text-align: center;
                padding: 0.5rem;
                color: var(--secondary-color);
                font-size: 0.85rem;
                font-style: italic;
            }
        }

        /* Fix iOS-specific issues */
        @supports (-webkit-touch-callout: none) {
            .form-control, .form-select {
                font-size: 16px; /* Prevent zoom on focus */
            }

            .table-responsive {
                -webkit-overflow-scrolling: touch;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
        }

        /* Mobile-friendly styles */
        @media (max-width: 768px) {
            .table-responsive {
                margin: 0 -1rem;
            }
            
            .table {
                font-size: 0.9rem;
            }
            
            .table td {
                white-space: normal;
                min-width: 120px;
            }
            
            .table td:first-child {
                position: sticky;
                left: 0;
                background: white;
                z-index: 1;
                border-right: 2px solid #dee2e6;
            }
            
            .status-badge {
                font-size: 0.8rem;
                padding: 0.25rem 0.5rem;
            }
            
            .card-header {
                padding: 0.75rem 1rem;
            }
            
            .popover {
                max-width: 280px;
            }
            
            .popover-body ul {
                padding-left: 0;
                margin-bottom: 0;
            }
            
            .popover-body li {
                margin-bottom: 0.5rem;
                font-size: 0.9rem;
            }
            
            /* Improve table scrolling on mobile */
            .table-responsive {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                scrollbar-width: thin;
            }
            
            /* Custom scrollbar for better mobile UX */
            .table-responsive::-webkit-scrollbar {
                height: 6px;
            }
            
            .table-responsive::-webkit-scrollbar-track {
                background: #f1f1f1;
            }
            
            .table-responsive::-webkit-scrollbar-thumb {
                background: #888;
                border-radius: 3px;
            }
        }

        /* Add utility class for responsive width */
        @media (min-width: 768px) {
            .w-md-auto {
                width: auto !important;
            }
        }

        /* Enhanced Results Styling */
        .results-section {
            border: none;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            border-radius: 12px;
            overflow: hidden;
        }

        .results-section .card-header {
            background: linear-gradient(135deg, #28a745, #20c997) !important;
            border: none;
        }

        .results-stats {
            text-align: right;
            line-height: 1.2;
        }

        .total-colleges-count {
            font-size: 1.2rem;
        }

        .table-container {
            padding: 0.5rem;
            background: #f8f9fa;
        }

        .table {
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        .table th {
            font-weight: 600;
            color: #495057;
            text-transform: uppercase;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
        }

        .table td {
            padding: 1rem;
            vertical-align: middle;
        }

        .status-badge {
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-weight: 500;
            font-size: 0.85rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
        }

        .status-badge.likely {
            background-color: rgba(40, 167, 69, 0.1);
            color: #28a745;
            border: 1px solid rgba(40, 167, 69, 0.2);
        }

        .status-badge.likely::before {
            content: '‚Ä¢';
            color: #28a745;
            font-size: 1.5rem;
            line-height: 1;
            margin-right: 0.25rem;
        }

        .status-badge.unlikely {
            background-color: rgba(220, 53, 69, 0.1);
            color: #dc3545;
            border: 1px solid rgba(220, 53, 69, 0.2);
        }

        .status-badge.unlikely::before {
            content: '‚Ä¢';
            color: #dc3545;
            font-size: 1.5rem;
            line-height: 1;
            margin-right: 0.25rem;
        }

        /* Mobile Optimizations */
        @media (max-width: 768px) {
            .results-section {
                border-radius: 0;
                margin: 0 -1rem;
            }

            .table td {
                padding: 0.75rem;
            }

            .table td:first-child {
                position: sticky;
                left: 0;
                background: white;
                z-index: 1;
                box-shadow: 2px 0 5px rgba(0,0,0,0.05);
            }

            .status-badge {
                padding: 0.35rem 0.75rem;
                font-size: 0.8rem;
            }

            .total-colleges-count {
                font-size: 1rem;
            }
        }

        /* Update results stats styling */
        .results-stats {
            min-width: 120px;
            backdrop-filter: blur(4px);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .results-stats:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15) !important;
        }

        .results-stats .total-colleges-count {
            font-size: 2rem;
            line-height: 1;
        }

        .hover-bright:hover {
            background-color: rgba(255,255,255,0.3) !important;
            transform: translateY(-1px);
        }

        /* Mobile optimization for results stats */
        @media (max-width: 768px) {
            .results-stats {
                min-width: 100px;
            }

            .results-stats .total-colleges-count {
                font-size: 1.5rem;
            }
        }

        /* Enhanced Select2 Styling to match default dropdowns */
        .select2-container {
            width: 100% !important;
            margin-bottom: 0 !important;
        }

        .select2-container--default .select2-selection--single,
        .select2-container--default .select2-selection--multiple {
            border: 2px solid #e0e0e0 !important;
            border-radius: 12px !important;
            min-height: 45px !important;
            background-color: #fff !important;
            transition: all 0.3s ease !important;
        }

        .select2-container--default.select2-container--focus .select2-selection--single,
        .select2-container--default.select2-container--focus .select2-selection--multiple,
        .select2-container--default.select2-container--open .select2-selection--single,
        .select2-container--default.select2-container--open .select2-selection--multiple {
            border-color: #3498db !important;
            box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25) !important;
        }

        .select2-container--default .select2-selection--multiple .select2-selection__choice {
            background-color: #3498db !important;
            border: none !important;
            color: white !important;
            border-radius: 20px !important;
            padding: 5px 10px !important;
            margin: 4px !important;
        }

        .select2-container--default .select2-selection__choice__remove {
            color: white !important;
            margin-right: 5px !important;
            border: none !important;
            background: none !important;
            padding: 0 5px !important;
        }

        .select2-container--default .select2-selection__choice__remove:hover {
            background-color: rgba(255, 255, 255, 0.2) !important;
            color: white !important;
        }

        .select2-dropdown {
            border: 2px solid #e0e0e0 !important;
            border-radius: 12px !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1) !important;
            margin-top: 4px !important;
        }

        .select2-search__field {
            border-radius: 8px !important;
            padding: 8px !important;
        }

        .select2-container--default .select2-search--dropdown .select2-search__field {
            border: 2px solid #e0e0e0 !important;
        }

        .select2-results__option {
            padding: 10px 12px !important;
            transition: all 0.2s ease !important;
        }

        .select2-container--default .select2-results__option--highlighted[aria-selected] {
            background-color: #3498db !important;
        }

        .select2-container--default .select2-results__group {
            padding: 10px !important;
            font-weight: 600 !important;
            background: #f8f9fa !important;
            color: #2c3e50 !important;
        }

        /* Enhanced Mobile Responsiveness */
        @media (max-width: 768px) {
            .container {
                padding: 1rem !important;
            }

            .header-section {
                padding: 1.5rem 1rem !important;
            }

            .header-section h1 {
                font-size: 1.8rem !important;
            }

            .form-section {
                padding: 1.25rem !important;
            }

            .select2-container--default .select2-selection--single,
            .select2-container--default .select2-selection--multiple {
                min-height: 42px !important;
            }

            .select2-container--default .select2-selection--multiple .select2-selection__choice {
                padding: 4px 8px !important;
                margin: 3px !important;
                font-size: 0.9rem !important;
            }

            .btn-primary {
                width: 100% !important;
                margin-top: 1rem !important;
            }

            .results-section {
                margin: 1rem -1rem !important;
                border-radius: 0 !important;
            }

            .table td {
                font-size: 0.9rem !important;
            }

            .status-badge {
                font-size: 0.8rem !important;
                padding: 4px 8px !important;
            }
        }

        /* Enhanced Card and Form Styling */
        .card {
            border: none !important;
            box-shadow: 0 8px 24px rgba(0,0,0,0.1) !important;
        }

        .form-section {
            background: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(10px) !important;
        }

        .form-label {
            font-weight: 600 !important;
            color: #2c3e50 !important;
            margin-bottom: 0.5rem !important;
        }

        .form-label i {
            color: #3498db !important;
            margin-right: 0.5rem !important;
        }

        /* Enhanced Button Styling */
        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9) !important;
            border: none !important;
            padding: 12px 24px !important;
            font-weight: 600 !important;
            letter-spacing: 0.5px !important;
            transition: all 0.3s ease !important;
        }

        .btn-primary:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4) !important;
        }

        /* Enhanced Table Styling */
        .table thead th {
            background: linear-gradient(135deg, #2c3e50, #3498db) !important;
            color: white !important;
            font-weight: 600 !important;
            text-transform: uppercase !important;
            font-size: 0.85rem !important;
            letter-spacing: 0.5px !important;
            padding: 15px !important;
        }

        .table tbody tr {
            transition: all 0.2s ease !important;
        }

        .table tbody tr:hover {
            background-color: rgba(52, 152, 219, 0.05) !important;
            transform: scale(1.01) !important;
        }

        /* Enhanced Status Badge Styling */
        .status-badge {
            padding: 6px 12px !important;
            border-radius: 20px !important;
            font-weight: 600 !important;
            letter-spacing: 0.5px !important;
            text-transform: uppercase !important;
            font-size: 0.75rem !important;
        }

        .status-badge.likely {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.1), rgba(39, 174, 96, 0.1)) !important;
            color: #27ae60 !important;
            border: 1px solid rgba(46, 204, 113, 0.2) !important;
        }

        .status-badge.unlikely {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.1), rgba(192, 57, 43, 0.1)) !important;
            color: #c0392b !important;
            border: 1px solid rgba(231, 76, 60, 0.2) !important;
        }

        /* Enhanced Animations */
        .animate__fadeIn {
            animation-duration: 0.5s !important;
        }

        .animate__fadeInUp {
            animation-duration: 0.6s !important;
        }

        /* Loading Overlay Enhancement */
        .loading-overlay {
            backdrop-filter: blur(8px) !important;
            background: rgba(255, 255, 255, 0.8) !important;
        }

        .loading-spinner {
            border-width: 3px !important;
            border-top-color: #3498db !important;
        }

        /* Enhanced Branch Dropdown Styling */
        .select2-container {
            width: 100% !important;
            margin-bottom: 0 !important;
        }

        .select2-container--default .select2-selection--single,
        .select2-container--default .select2-selection--multiple {
            border: 2px solid #e0e0e0 !important;
            border-radius: 12px !important;
            min-height: 45px !important;
            background-color: #fff !important;
            transition: all 0.3s ease !important;
            padding: 8px !important;
        }

        .select2-container--default .select2-selection--single .select2-selection__rendered {
            line-height: 28px !important;
            padding-left: 8px !important;
        }

        .select2-container--default .select2-selection--single .select2-selection__arrow {
            height: 45px !important;
            right: 8px !important;
        }

        .select2-dropdown {
            border: 2px solid #e0e0e0 !important;
            border-radius: 12px !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1) !important;
            margin-top: 4px !important;
            overflow: hidden !important;
        }

        .select2-container--default .select2-results__option {
            padding: 8px 12px !important;
            transition: all 0.2s ease !important;
        }

        .select2-container--default .select2-results__option--highlighted[aria-selected] {
            background-color: #3498db !important;
            color: white !important;
        }

        .select2-container--default .select2-results__group {
            padding: 10px !important;
            font-weight: 600 !important;
            background: #f8f9fa !important;
            color: #2c3e50 !important;
            font-size: 0.9rem !important;
            text-transform: uppercase !important;
            letter-spacing: 0.5px !important;
        }

        .select2-container--default .select2-search--dropdown .select2-search__field {
            border: 2px solid #e0e0e0 !important;
            border-radius: 8px !important;
            padding: 8px !important;
            transition: all 0.3s ease !important;
        }

        .select2-container--default .select2-search--dropdown .select2-search__field:focus {
            border-color: #3498db !important;
            outline: none !important;
            box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25) !important;
        }

        .course-name {
            font-size: 0.95rem !important;
            color: #2c3e50 !important;
        }

        .badge {
            font-family: monospace !important;
            font-size: 0.9rem !important;
            padding: 4px 8px !important;
        }

        /* Mobile Optimization for Branch Dropdown */
        @media (max-width: 768px) {
            .select2-container--default .select2-selection--single,
            .select2-container--default .select2-selection--multiple {
                min-height: 42px !important;
                padding: 6px !important;
            }

            .select2-container--default .select2-selection--single .select2-selection__rendered {
                line-height: 24px !important;
            }

            .select2-container--default .select2-results__option {
                padding: 6px 10px !important;
                font-size: 0.9rem !important;
            }

            .select2-container--default .select2-results__group {
                padding: 8px !important;
                font-size: 0.85rem !important;
            }

            .course-name {
                font-size: 0.9rem !important;
            }

            .badge {
                font-size: 0.85rem !important;
                padding: 3px 6px !important;
            }
        }

        /* Appreciation Section Styles */
        .appreciation-section .card {
            background: linear-gradient(135deg, #ffffff, #f8f9fa);
            border: none;
            transition: transform 0.3s ease;
        }

        .appreciation-section .card:hover {
            transform: translateY(-2px);
        }

        .appreciation-section .bg-gradient-primary {
            background: linear-gradient(135deg, #e8f4f8, #ffffff);
            border: 1px solid #e3f2fd;
        }

        .appreciation-section .card-body {
            font-size: 0.85rem;
            line-height: 1.4;
        }

        .appreciation-section code {
            font-family: monospace;
            font-size: 0.85em;
            white-space: nowrap;
        }

        .appreciation-section .fa-heart {
            color: #dc3545;
            filter: drop-shadow(0 0 2px rgba(220, 53, 69, 0.3));
            font-size: 0.9em;
        }

        .appreciation-section .fa-star {
            color: #ffc107;
            filter: drop-shadow(0 0 2px rgba(255, 193, 7, 0.3));
            font-size: 0.8em;
        }

        .appreciation-section .small {
            font-size: 0.8rem;
        }

        @keyframes heartBeat {
            0% { transform: scale(1); }
            14% { transform: scale(1.3); }
            28% { transform: scale(1); }
            42% { transform: scale(1.3); }
            70% { transform: scale(1); }
        }

        .appreciation-section .animate__heartBeat {
            animation: heartBeat 1.3s ease-in-out infinite;
        }

        @media (max-width: 768px) {
            .appreciation-section .card-body {
                padding: 0.5rem !important;
                font-size: 0.8rem;
            }
            
            .appreciation-section code {
                font-size: 0.75em;
                display: inline-block;
                margin: 0.25rem 0;
            }

            .appreciation-section .small {
                font-size: 0.75rem;
            }

            .appreciation-section .gap-2 {
                gap: 0.25rem !important;
            }
        }

        /* Loading Overlay Styles */
    </style>
</head>
<body>
    <div class="loading-overlay">
        <div class="loading-spinner"></div>
    </div>

    <div class="container">
        <div class="header-section">
            <h1>
                <i class="fas fa-compass"></i>
                KCET College Compass
            </h1>
            <p>Advanced Engineering College Analytics & Admission Insights</p>
        </div>

        <!-- Appreciation Message -->
        <div class="appreciation-section animate__animated animate__fadeIn mb-4">
            <div class="card bg-gradient-primary border-0 shadow-sm">
                <div class="card-body p-2">
                    <div class="d-flex align-items-center flex-wrap gap-2">
                        <span class="d-flex align-items-center">
                            <i class="fas fa-heart text-danger animate__animated animate__heartBeat animate__infinite me-1"></i>
                            <span class="text-primary fw-semibold">Appreciate My Work?</span>
                        </span>
                        <span class="text-muted small">I built this platform from scratch to help students ‚Äî completely free .You can  send a small digital gift card to:</span>
                        <code class="text-primary bg-light px-2 py-1 rounded">üìß collegecompass.shield594@slmail.me</code>
                        <span class="text-muted small">
                            <i class="fas fa-star text-warning"></i>
                            Every little bit helps! üôè
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <div class="disclaimer-section animate__animated animate__fadeIn">
            <div class="disclaimer-title">
                <i class="fas fa-exclamation-triangle"></i>
                IMPORTANT DISCLAIMER
            </div>
            <div class="disclaimer-content">
                <ul class="disclaimer-points">
                    <li>This website is currently in its beta phase. While we strive to provide accurate and up-to-date information, please note that there may be occasional bugs or updates. Your feedback is greatly appreciated!</li>
                    <li>This tool currently provides cutoff data for general categories (GM, SC, ST, etc.). Hyderabad-Karnataka (HK) region data will be added in future updates.</li>
                    <li>The predictions are for <strong>informational and educational purposes only</strong> and do not guarantee admission.</li>
                    <li>Actual cutoffs may vary based on reservation policies, seat matrix changes, and updated counseling rounds.</li>
                    <li>Always verify information with the official KEA (Karnataka Examinations Authority) website before making decisions.</li>
                    <li><strong>USE AT YOUR OWN RISK:</strong> The creators are not responsible for any discrepancies, decisions, or consequences arising from the use of this data.</li>
                </ul>
                <div style="font-size: 0.9rem; color: #e74c3c; font-style: italic; margin-top: 1rem;">
                    By using this tool, you acknowledge that you have read and understood this disclaimer.
                </div>
            </div>
        </div>

        <div class="form-section">
            <form id="cutoffForm">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="form-group">
                            <label for="rank" class="form-label">
                                <i class="fas fa-trophy"></i> Your Rank
                            </label>
                            <input type="number" id="rank" name="rank" class="form-control" min="1" required>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="form-group">
                            <label for="category" class="form-label">
                                <i class="fas fa-users"></i> Category
                            </label>
                            <select id="category" name="category" class="form-select" required>
                                <option value="">Select Category</option>
                                <!-- Base Categories -->
                                <optgroup label="General Merit">
                                    <option value="GM">General Merit (GM)</option>
                                    <option value="GMH">General Merit - HK (GMH)</option>
                                    <option value="GMK">General Merit - KK (GMK)</option>
                                    <option value="GMR">General Merit - Rural (GMR)</option>
                                    <option value="GMKH">General Merit - KK & HK (GMKH)</option>
                                    <option value="GMRH">General Merit - Rural & HK (GMRH)</option>
                                </optgroup>
                                
                                <!-- Category 1 -->
                                <optgroup label="Category 1">
                                    <option value="1G">Category 1 (1G)</option>
                                    <option value="1H">Category 1 - HK (1H)</option>
                                    <option value="1K">Category 1 - KK (1K)</option>
                                    <option value="1R">Category 1 - Rural (1R)</option>
                                    <option value="1KH">Category 1 - KK & HK (1KH)</option>
                                    <option value="1RH">Category 1 - Rural & HK (1RH)</option>
                                </optgroup>
                                
                                <!-- Category 2A -->
                                <optgroup label="Category 2A">
                                    <option value="2AG">Category 2A (2AG)</option>
                                    <option value="2AH">Category 2A - HK (2AH)</option>
                                    <option value="2AK">Category 2A - KK (2AK)</option>
                                    <option value="2AR">Category 2A - Rural (2AR)</option>
                                    <option value="2AKH">Category 2A - KK & HK (2AKH)</option>
                                    <option value="2ARH">Category 2A - Rural & HK (2ARH)</option>
                                </optgroup>
                                
                                <!-- Category 2B -->
                                <optgroup label="Category 2B">
                                    <option value="2BG">Category 2B (2BG)</option>
                                    <option value="2BH">Category 2B - HK (2BH)</option>
                                    <option value="2BK">Category 2B - KK (2BK)</option>
                                    <option value="2BR">Category 2B - Rural (2BR)</option>
                                    <option value="2BKH">Category 2B - KK & HK (2BKH)</option>
                                    <option value="2BRH">Category 2B - Rural & HK (2BRH)</option>
                                </optgroup>
                                
                                <!-- Category 3A -->
                                <optgroup label="Category 3A">
                                    <option value="3AG">Category 3A (3AG)</option>
                                    <option value="3AH">Category 3A - HK (3AH)</option>
                                    <option value="3AK">Category 3A - KK (3AK)</option>
                                    <option value="3AR">Category 3A - Rural (3AR)</option>
                                    <option value="3AKH">Category 3A - KK & HK (3AKH)</option>
                                    <option value="3ARH">Category 3A - Rural & HK (3ARH)</option>
                                </optgroup>
                                
                                <!-- Category 3B -->
                                <optgroup label="Category 3B">
                                    <option value="3BG">Category 3B (3BG)</option>
                                    <option value="3BH">Category 3B - HK (3BH)</option>
                                    <option value="3BK">Category 3B - KK (3BK)</option>
                                    <option value="3BR">Category 3B - Rural (3BR)</option>
                                    <option value="3BKH">Category 3B - KK & HK (3BKH)</option>
                                    <option value="3BRH">Category 3B - Rural & HK (3BRH)</option>
                                </optgroup>
                                
                                <!-- SC Categories -->
                                <optgroup label="Scheduled Caste">
                                    <option value="SC">Scheduled Caste (SC)</option>
                                    <option value="SCH">SC - HK (SCH)</option>
                                    <option value="SCK">SC - KK (SCK)</option>
                                    <option value="SCR">SC - Rural (SCR)</option>
                                    <option value="SCKH">SC - KK & HK (SCKH)</option>
                                    <option value="SCRH">SC - Rural & HK (SCRH)</option>
                                </optgroup>
                                
                                <!-- ST Categories -->
                                <optgroup label="Scheduled Tribe">
                                    <option value="ST">Scheduled Tribe (ST)</option>
                                    <option value="STH">ST - HK (STH)</option>
                                    <option value="STK">ST - KK (STK)</option>
                                    <option value="STR">ST - Rural (STR)</option>
                                    <option value="STKH">ST - KK & HK (STKH)</option>
                                    <option value="STRH">ST - Rural & HK (STRH)</option>
                                </optgroup>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="form-group">
                            <label for="year" class="form-label">
                                <i class="fas fa-calendar"></i> Academic Year
                            </label>
                            <select id="year" name="year" class="form-select" required>
                                <option value="">Select Year</option>
                                {% for year in years %}
                                    <option value="{{ year }}">{{ year }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="form-group">
                            <label for="round" class="form-label">
                                <i class="fas fa-clock"></i> Admission Round
                            </label>
                            <select id="round" name="round_name" class="form-select" required>
                                <option value="">Select Round</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="form-group">
                            <label for="institute" class="form-label">
                                <i class="fas fa-university"></i> Institution
                            </label>
                            <select id="institute" name="institute" class="form-select">
                                <option value="">All Institutions</option>
                                {% for inst in institutes %}
                                    <option value="{{ inst.key }}">{{ inst.name }} ({{ inst.code }})</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="form-group">
                            <label for="course" class="form-label">
                                <i class="fas fa-graduation-cap"></i> Engineering Branch
                            </label>
                            <select id="course" name="course" class="form-select">
                                <option value="">All Branches</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="form-group">
                            <label for="location" class="form-label">
                                <i class="fas fa-map-marker-alt"></i> Location 
                                <span class="badge bg-warning text-dark" style="font-size: 0.7rem; vertical-align: super;">BETA</span>
                                <i class="fas fa-info-circle text-warning ms-1" 
                                   data-bs-toggle="tooltip" 
                                   data-bs-placement="top" 
                                   title="Location filter is in beta. Some colleges might not appear in search results due to naming variations."></i>
                            </label>
                            <div class="alert alert-warning py-1 px-2 mb-2" style="font-size: 0.8rem;">
                                <i class="fas fa-exclamation-triangle me-1"></i>
                                Location search is experimental and may not show all colleges in a selected area.
                            </div>
                            <select id="location" name="location" class="form-select">
                                <option value="">All Locations</option>
                                <optgroup label="Major Cities" class="location-group">
                                    <option value="BLR">Bengaluru</option>
                                    <option value="MYS">Mysuru</option>
                                    <option value="HUB">Hubballi</option>
                                    <option value="MLR">Mangaluru</option>
                                    <option value="BEL">Belagavi</option>
                                </optgroup>
                                <optgroup label="Other Regions" class="location-group">
                                    <option value="KOL">Kolar</option>
                                    <option value="TUM">Tumakuru</option>
                                    <option value="DVG">Davangere</option>
                                    <option value="KLB">Kalburgi</option>
                                    <option value="BDR">Bidar</option>
                                    <option value="BGK">Bagalkot</option>
                                    <option value="HSN">Hassan</option>
                                    <option value="DWD">Dharwad</option>
                                    <option value="MDY">Mandya</option>
                                    <option value="SKT">Shivamogga</option>
                                </optgroup>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="mb-4 form-check d-flex align-items-start">
                    <div>
                        <input type="checkbox" id="include_nearby" name="include_nearby" class="form-check-input">
                        <label for="include_nearby" class="form-check-label">
                            <i class="fas fa-arrows-alt-h"></i> Include Nearby Ranks
                        </label>
                    </div>
                    <div class="ms-2">
                        <button type="button" class="btn btn-link btn-sm text-info p-0" 
                                data-bs-toggle="popover" 
                                data-bs-placement="top"
                                data-bs-html="true"
                                data-bs-title="Nearby Ranks Info"
                                data-bs-content="<ul class='list-unstyled mb-0'>
                                    <li><i class='fas fa-check-circle text-success'></i> ¬±15% rank range</li>
                                    <li><i class='fas fa-check-circle text-success'></i> Up to 75k higher ranks</li>
                                    <li><i class='fas fa-check-circle text-success'></i> Previous round data</li>
                                </ul>">
                            <i class="fas fa-info-circle"></i>
                        </button>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary w-100 w-md-auto">
                    <i class="fas fa-search"></i> Analyze Options
                </button>
            </form>
        </div>

        <div id="result" class="card results-section d-none">
            <div class="card-header position-relative py-3">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="mb-0 text-white">
                        <i class="fas fa-chart-bar me-2"></i> Analysis Results
                    </h5>
                    <div class="d-flex align-items-center gap-3">
                        <div class="results-stats text-center px-3 py-2 bg-white bg-opacity-15 rounded-3" 
                             style="border: 1px solid rgba(255,255,255,0.2); box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                            <div class="total-colleges-count display-6 fw-bold text-white mb-0"></div>
                            <div class="text-white-50 small text-uppercase">Total Colleges</div>
                        </div>
                        <button type="button" class="btn btn-sm btn-light bg-white bg-opacity-20 text-white border-0 hover-bright" 
                                data-bs-toggle="popover"
                                data-bs-placement="left"
                                data-bs-html="true"
                                data-bs-title="Results Info"
                                data-bs-content="<ul class='list-unstyled mb-0 small'>
                                    <li class='mb-2'><i class='fas fa-info-circle text-primary'></i> Results are sorted by cutoff rank</li>
                                    <li class='mb-2'><i class='fas fa-check-circle text-success'></i> 'Good Match': Cutoff rank higher than yours</li>
                                    <li><i class='fas fa-percentage text-info'></i> Percentage shows rank difference</li>
                                </ul>">
                            <i class="fas fa-info-circle"></i>
                        </button>
                    </div>
                </div>
            </div>
            <div class="table-container">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0">
                        <thead>
                            <tr class="bg-light">
                                <th class="border-bottom-0 py-3">Institution</th>
                                <th class="border-bottom-0 py-3">Branch</th>
                                <th class="border-bottom-0 py-3">Category</th>
                                <th class="border-bottom-0 py-3">Cutoff Rank</th>
                                <th class="border-bottom-0 py-3">Round</th>
                                <th class="border-bottom-0 py-3">Year</th>
                                <th class="border-bottom-0 py-3">Status</th>
                            </tr>
                        </thead>
                        <tbody id="cutoffTable">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="error" class="alert alert-danger d-none" role="alert"></div>
    </div>

    <script>
        $(document).ready(function() {
            const roundsByYear = {
                '2019': ['2019 Round 1', '2019 Round 2', '2019 Round 3'],
                '2020': ['2020 Round 1', '2020 Round 2', '2020 Round 3'],
                '2021': ['2021 Round 1', '2021 Round 2', '2021 Round 3'],
                '2022': ['2022 Round 1', '2022 Round 2', '2022 Round 3'],
                '2023': ['2023 Extended Round', '2023 Round 1', '2023 Round 2'],
                '2024': ['2024 Mock Round 1', '2024 Mock Round 2', '2024 Round 1', '2024 Round 2', '2024 Round 3']
            };

            let currentRequest = null;

            $(document).ajaxStart(function() {
                $('.loading-overlay').fadeIn(300);
            }).ajaxStop(function() {
                $('.loading-overlay').fadeOut(300);
            });

            $('#year').change(function() {
                const year = $(this).val();
                const $round = $('#round');
                $round.empty().append('<option value="">Select Round</option>');
                
                if (year && roundsByYear[year]) {
                    // Add "All Rounds" option for the selected year
                    $round.append(`<option value="${year} All Rounds">${year} All Rounds</option>`);
                    
                    // Add individual rounds
                    roundsByYear[year].forEach(round => {
                        // Only add mock rounds for 2024, skip for historical years
                        if (!round.includes('Mock') || year === '2024') {
                            $round.append(`<option value="${round}">${round}</option>`);
                        }
                    });
                }
                
                // Reset results when year changes
                $('#result').addClass('d-none');
                $('#error').addClass('d-none');
            });

            // Trigger initial load of rounds for pre-selected year if any
            if ($('#year').val()) {
                $('#year').trigger('change');
            }

            // Initialize branch dropdown with consistent styling
            function initializeCourseSelect() {
                const $courseSelect = $('#course');
                
                if ($courseSelect.hasClass('select2-hidden-accessible')) {
                    $courseSelect.select2('destroy');
                }

                $courseSelect.select2({
                    width: '100%',
                    placeholder: 'Select Branch',
                    allowClear: true,
                    templateResult: formatCourse,
                    templateSelection: formatCourseSelection
                });

                // Add placeholder to search field
                $courseSelect.on('select2:opening', function() {
                    setTimeout(() => {
                        $('.select2-search__field').attr('placeholder', 'Type to search branches...');
                    }, 0);
                });
            }

            function formatCourse(course) {
                if (!course.id) return course.text;
                const name = course.element.text.split(' - ')[1] || '';
                return $(`<div class="d-flex align-items-center">
                    <span class="badge bg-primary bg-opacity-10 text-primary me-2">${course.id}</span>
                    <span class="course-name">${name}</span>
                </div>`);
            }

            function formatCourseSelection(course) {
                if (!course.id) return course.text;
                const name = course.element.text.split(' - ')[1] || '';
                return $(`<div class="d-flex align-items-center">
                    <span class="badge bg-primary bg-opacity-10 text-primary me-2">${course.id}</span>
                    <span class="course-name">${name}</span>
                </div>`);
            }

            function loadCourses() {
                const $courseSelect = $('#course');
                
                // Define all courses with their groups
                const courses = {
                    'Computer Science & AI/ML': [
                        {code: 'AD', name: 'Artificial Intelligence And Data Science'},
                        {code: 'AI', name: 'Artificial Intelligence and Machine Learning'},
                        {code: 'AM', name: 'B TECH IN COMP SCI & ENGG (AI & ML)'},
                        {code: 'BF', name: 'B TECH (HONS) COMP SCI AND ENGG(DATA SCIENCE)'},
                        {code: 'BG', name: 'B TECH IN ARTIFICIAL INTELLI AND DATA SCIENCE'},
                        {code: 'BH', name: 'B TECH IN ARTIFICIAL INTELLIGENCE AND ML'},
                        {code: 'BN', name: 'B TECH IN COMPUTER SCIENCE AND TECH(BIG DATA)'},
                        {code: 'BQ', name: 'B TECH IN COMPUTER SCIENCE AND TECHNOLOGY'},
                        {code: 'BU', name: 'B TECH IN COMPUTER SCIENCE AND INFO TECH'},
                        {code: 'BV', name: 'B TECH IN COMPUTER ENGINEERING'},
                        {code: 'BW', name: 'B TECH IN COMPUTER SCIENCE AND ENGINEERING'},
                        {code: 'BX', name: 'B TECH IN COMP SCIENCE AND ENGG(CYBER SECURITY)'},
                        {code: 'BY', name: 'B TECH IN COMP SCIENCE AND TECHNOLOGY(DEV OPS)'},
                        {code: 'BZ', name: 'B TECH IN COMPUTER SCIENCE AND ENGG(DATA SCIENCE)'},
                        {code: 'CA', name: 'Computer Science Engineering-AI, Machine Learning'},
                        {code: 'CF', name: 'Computer Science Engineering-Artificial Intel.'},
                        {code: 'CG', name: 'Computer Science and Technology'},
                        {code: 'CI', name: 'Computer Science and Information Technology'},
                        {code: 'CO', name: 'Computer Engineering'},
                        {code: 'CS', name: 'Computers Science And Engineering'},
                        {code: 'CY', name: 'Computer Science Engineering-Cyber Security'},
                        {code: 'DC', name: 'Data Sciences'},
                        {code: 'DK', name: 'B TECH IN COMPUTER SCIENCE AND SYSTEM ENGG'},
                        {code: 'DL', name: 'B TECH IN COMPUTER SCIENCE'},
                        {code: 'DS', name: 'Computer Science Engineering-Data Sciences'},
                        {code: 'ZC', name: 'COMPUTER SCIENCE'}
                    ],
                    'Electronics & Communication': [
                        {code: 'BB', name: 'B TECH IN ELECTRONICS & COMMUNICATION ENGINEERING'},
                        {code: 'BE', name: 'Bio-Electronics Engineering'},
                        {code: 'BJ', name: 'B TECH IN ELECTRICAL & ELECTRONICS ENGINEERING'},
                        {code: 'CL', name: 'B TECH IN ELECTRONICS & COMPUTER ENGINEERING'},
                        {code: 'CM', name: 'ELECTRONICS ENGINEERING(VLSI DESIGN & TECH)'},
                        {code: 'DN', name: 'B.Tech in VLSI'},
                        {code: 'EB', name: 'ELECTRONICS AND COMMUNICATION (ADV COMM TECH)'},
                        {code: 'EC', name: 'Electronics and Communication Engineering'},
                        {code: 'EE', name: 'Electrical And Electronics Engineering'},
                        {code: 'EI', name: 'Electronics and Instrumentation Engineering'},
                        {code: 'EL', name: 'Electronics and Instrumentation Tech.'},
                        {code: 'ES', name: 'Electronics and Computer Engineering'},
                        {code: 'ET', name: 'Electronics and Telecommunication Engineering'},
                        {code: 'EV', name: 'Electronics Engineering(VLSI Design Technology)'},
                        {code: 'II', name: 'Elec. and Communication- Industrial Integrated'},
                        {code: 'MD', name: 'Medical Electronics'},
                        {code: 'TC', name: 'Telecommunication Engineering'}
                    ],
                    'Information Technology': [
                        {code: 'BC', name: 'BTech Computer Technology'},
                        {code: 'BD', name: 'Computer Science Engineering-Big Data'},
                        {code: 'BI', name: 'Information Technology and Engineering'},
                        {code: 'CB', name: 'Computer Science and Business Systems'},
                        {code: 'CC', name: 'Computer and Communication Engineering'},
                        {code: 'CD', name: 'Computer Science and Design'},
                        {code: 'CU', name: 'B TECH IN INFORMATION SCIENCE ENGINEERING'},
                        {code: 'CW', name: 'B TECH IN INFORMATION TECHNOLOGY'},
                        {code: 'CX', name: 'B TECH IN INFORMATION SCIENCE & TECHNOLOGY'},
                        {code: 'IE', name: 'Information Science and Engineering'},
                        {code: 'IG', name: 'Information Technology'},
                        {code: 'IS', name: 'Information Science and Technology'},
                        {code: 'IT', name: 'Instrumentation Technology'}
                    ],
                    'IoT & Blockchain': [
                        {code: 'CN', name: 'B TECH IN COMP SCI AND ENGG(IOT AND BLOCK CHAIN)'},
                        {code: 'CQ', name: 'B TECH IN COMPUTER SCIENCE AND ENGINEERING(IOT)'},
                        {code: 'CZ', name: 'B TECH IN COMPUTER SCIENCE AND ENGG(BLOCK CHAIN)'},
                        {code: 'IB', name: 'Computer Science Engg-IoT including Block Chain'},
                        {code: 'IC', name: 'CS-Internet of things, Cyber Security(Block Chain)'},
                        {code: 'IO', name: 'Computer Science Engineering-Internet of Things'},
                        {code: 'IY', name: 'CS - Information Technology-Cyber Security'},
                        {code: 'LC', name: 'Computer Science Engineering-Block Chain'},
                        {code: 'OT', name: 'Industrial IOT'},
                        {code: 'TI', name: 'Industrial IoT'}
                    ],
                    'Mechanical & Manufacturing': [
                        {code: 'AT', name: 'Automotive Engineering'},
                        {code: 'AU', name: 'Automobile Engineering'},
                        {code: 'DB', name: 'B TECH IN MECHANICAL ENGINEERING'},
                        {code: 'ME', name: 'Mechanical Engineering'},
                        {code: 'MK', name: 'Mechanical Engineering (Kannada Medium)'},
                        {code: 'MM', name: 'Mechanical and Smart Manufacturing'},
                        {code: 'MS', name: 'Manufacturing Science and Engineering'},
                        {code: 'PM', name: 'Precision Manufacturing'},
                        {code: 'TE', name: 'Tool Engineering'}
                    ],
                    'Civil & Architecture': [
                        {code: 'AR', name: 'Architecture'},
                        {code: 'BP', name: 'B TECH IN CIVIL ENGINEERING'},
                        {code: 'CE', name: 'Civil Engineering'},
                        {code: 'CK', name: 'Civil Engineering (Kannada Medium)'},
                        {code: 'CP', name: 'Civil Engineering and Planning'},
                        {code: 'CT', name: 'Construction Technology and Management'},
                        {code: 'CV', name: 'Civil Environmental Engineering'},
                        {code: 'LA', name: 'B Plan'},
                        {code: 'UP', name: 'Planning'},
                        {code: 'UR', name: 'Planning'}
                    ],
                    'Robotics & Automation': [
                        {code: 'BR', name: 'BioMedical and Robotic Engineering'},
                        {code: 'DF', name: 'B TECH IN ROBOTICS AND AUTOMATION'},
                        {code: 'DH', name: 'B Tech in ROBOTICS AND ARTIFICIAL INTELLIGENCE'},
                        {code: 'DI', name: 'B TECH IN ROBOTIC ENGINEERING'},
                        {code: 'DJ', name: 'B TECH IN ROBOTICS'},
                        {code: 'RA', name: 'Robotics and Automation'},
                        {code: 'RB', name: 'Robotics'},
                        {code: 'RI', name: 'Robotics and Artificial Intelligence'},
                        {code: 'RM', name: 'Computer Science - Robotic Engineering-AI and ML'},
                        {code: 'RO', name: 'Automation and Robotics Engineering'}
                    ],
                    'Aerospace & Marine': [
                        {code: 'AE', name: 'Aeronautical Engineering'},
                        {code: 'BL', name: 'B TECH IN AERO SPACE ENGINEERING'},
                        {code: 'MR', name: 'Marine Engineering'},
                        {code: 'SE', name: 'Aero Space Engineering'}
                    ],
                    'Bio & Chemical': [
                        {code: 'BM', name: 'Bio Medical Engineering'},
                        {code: 'BO', name: 'B TECH IN BIO-TECHNOLOGY'},
                        {code: 'BT', name: 'Bio Technology'},
                        {code: 'CH', name: 'Chemical Engineering'},
                        {code: 'CR', name: 'Ceramics and Cement Technology'},
                        {code: 'PE', name: 'Petrochem Engineering'},
                        {code: 'PL', name: 'Petroleum Engineering'},
                        {code: 'PT', name: 'Polymer Science and Technology'}
                    ],
                    'Other Engineering': [
                        {code: 'BA', name: 'B.Tech(Agri.Engg)'},
                        {code: 'BK', name: 'B TECH IN ENERGY ENGINEERING'},
                        {code: 'BS', name: 'Bachelor of Science (Honours)'},
                        {code: 'DA', name: 'B TECH IN MATHAMATICS AND COMPUTING'},
                        {code: 'DD', name: 'B TECH IN MECHATRONICS ENGINEERING'},
                        {code: 'DE', name: 'B TECH IN PETROLEUM ENGINEERING'},
                        {code: 'DG', name: 'DESIGN'},
                        {code: 'DM', name: 'COMPUTER SCIENCE AND ENGINEERING (NETWORKS)'},
                        {code: 'EA', name: 'Agriculture Engineering'},
                        {code: 'EG', name: 'Energy Engineering'},
                        {code: 'EN', name: 'Environmental Engineering'},
                        {code: 'EP', name: 'BTech Technology and Entrepreneurship'},
                        {code: 'ER', name: 'Electrical and Computer Engineering'},
                        {code: 'IM', name: 'Industrial Engineering and Management'},
                        {code: 'IP', name: 'Industrial and Production Engineering'},
                        {code: 'MC', name: 'Mathematics and Computing'},
                        {code: 'MT', name: 'Mechatronics'},
                        {code: 'NT', name: 'Nano Technology'},
                        {code: 'OP', name: 'Computer Science Engineering-Dev Ops'},
                        {code: 'SA', name: 'Smart Agritech'},
                        {code: 'SS', name: 'Computer Science and System Engineering'},
                        {code: 'ST', name: 'Silk Technology'},
                        {code: 'TX', name: 'Textile Technology'},
                        {code: 'mn', name: 'Mining Engineering'}
                    ]
                };

                // Clear and add "All Branches" option
                $courseSelect.empty().append(new Option('All Branches', '', false, false));

                // Add courses by group
                Object.entries(courses).forEach(([group, groupCourses]) => {
                    const $optgroup = $('<optgroup>').attr('label', group);
                    groupCourses.sort((a, b) => a.code.localeCompare(b.code))
                        .forEach(course => {
                            $optgroup.append(new Option(
                                `${course.code} - ${course.name}`,
                                course.code,
                                false,
                                false
                            ));
                        });
                    $courseSelect.append($optgroup);
                });

                // Initialize Select2
                initializeCourseSelect();
            }

            // Load courses on page load
            loadCourses();

            // Handle window resize
            let resizeTimer;
            $(window).on('resize', function() {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(function() {
                    const $courseSelect = $('#course');
                    if ($courseSelect.data('select2')) {
                        $courseSelect.select2('close');
                    }
                }, 250);
            });

            $('#cutoffForm').on('submit', function(e) {
                e.preventDefault();
                
                if (currentRequest) {
                    currentRequest.abort();
                }

                const formData = $(this).serializeArray();
                const jsonData = {};
                
                formData.forEach(item => {
                    if (item.name === 'include_nearby') {
                        jsonData[item.name] = true;
                    } else if (item.name === 'rank') {
                        const rankValue = parseInt(item.value);
                        if (isNaN(rankValue) || rankValue <= 0) {
                            $('#error').removeClass('d-none')
                                .text('Please enter a valid rank number');
                            return;
                        }
                        jsonData[item.name] = rankValue;
                    } else if (item.name === 'course') {
                        // Handle course selection - include empty for "All Branches"
                        if (item.value && item.value !== '') {
                            jsonData[item.name] = item.value;
                        }
                    } else {
                        jsonData[item.name] = item.value || '';
                    }
                });

                // Get location value
                const selectedLocation = $('#location').val();

                // Function to filter colleges by location
                function filterCollegesByLocation(colleges, location) {
                    if (!location) return colleges;  // Return all if no location selected
                    
                    const locationMap = {
                        'BLR': ['Bengaluru', 'Bangalore', 'bengaluru', 'bangalore'],
                        'MYS': ['Mysuru', 'Mysore', 'mysuru', 'mysore'],
                        'HUB': ['Hubballi', 'Hubli', 'hubballi', 'hubli'],
                        'MLR': ['Mangaluru', 'Mangalore', 'mangaluru', 'mangalore'],
                        'BEL': ['Belagavi', 'Belgaum', 'belagavi', 'belgaum'],
                        'KOL': ['Kolar', 'kolar'],
                        'TUM': ['Tumakuru', 'Tumkur', 'tumakuru', 'tumkur'],
                        'DVG': ['Davangere', 'davangere'],
                        'KLB': ['Kalburgi', 'Gulbarga', 'kalburgi', 'gulbarga'],
                        'BDR': ['Bidar', 'bidar'],
                        'BGK': ['Bagalkot', 'bagalkot'],
                        'HSN': ['Hassan', 'hassan'],
                        'DWD': ['Dharwad', 'dharwad'],
                        'MDY': ['Mandya', 'mandya'],
                        'SKT': ['Shivamogga', 'Shimoga', 'shivamogga', 'shimoga']
                    };

                    return colleges.filter(college => {
                        const instituteName = college.institute.toLowerCase();
                        const locationTerms = locationMap[location] || [];
                        return locationTerms.some(term => instituteName.includes(term.toLowerCase()));
                    });
                }

                currentRequest = $.ajax({
                    url: '/predict',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(jsonData),
                    success: function(response) {
                        if (response.error || response.message) {
                            $('#error').removeClass('d-none')
                                .text(response.error || response.message);
                            $('#result').addClass('d-none');
                            return;
                        }

                        if (Array.isArray(response) && response.length > 0) {
                            // Filter colleges by location if selected
                            const filteredColleges = filterCollegesByLocation(response, selectedLocation);

                            if (filteredColleges.length === 0) {
                                $('#error').removeClass('d-none')
                                    .text('No colleges found in the selected location. Try a different location or view all locations.');
                                $('#result').addClass('d-none');
                                return;
                            }

                            // Update total colleges count
                            $('.total-colleges-count').text(filteredColleges.length);
                            
                            // Clear existing content
                            $('#cutoffTable').empty();

                            // Add colleges to table
                            filteredColleges.forEach(college => {
                                const rankDiff = college.rank_diff.toFixed(1);
                                const rankDiffText = rankDiff > 0 ? 
                                    `<span class="text-success ms-2">(+${rankDiff}%)</span>` : 
                                    `<span class="text-danger ms-2">(${rankDiff}%)</span>`;

                                const status = college.likely ? 
                                    '<span class="status-badge likely">Good Match</span>' : 
                                    '<span class="status-badge unlikely">Higher Rank Required</span>';

                                $('#cutoffTable').append(`
                                    <tr class="animate__animated animate__fadeIn">
                                        <td>
                                            <div class="fw-semibold">${college.institute}</div>
                                            <small class="text-muted">${college.institute_code}</small>
                                        </td>
                                        <td>
                                            <div class="fw-semibold">${college.course}</div>
                                            <small class="text-muted">${college.course_code}</small>
                                        </td>
                                        <td>
                                            <span class="fw-medium">${college.category}</span>
                                        </td>
                                        <td>
                                            <div class="d-flex align-items-center">
                                                <span class="fw-semibold">${college.cutoff_rank}</span>
                                                ${rankDiffText}
                                            </div>
                                        </td>
                                        <td>${college.round}</td>
                                        <td>${college.year}</td>
                                        <td>${status}</td>
                                    </tr>
                                `);
                            });

                            $('#result').removeClass('d-none');
                            $('html, body').animate({
                                scrollTop: $('#result').offset().top - 20
                            }, 500);
                        } else {
                            $('#error').removeClass('d-none')
                                .text('No colleges found matching your criteria. Try adjusting your filters or including nearby ranks.');
                            $('#result').addClass('d-none');
                        }
                    },
                    error: function(xhr, status, error) {
                        let errorMessage = 'An error occurred while analyzing options. ';
                        if (xhr.responseJSON && xhr.responseJSON.error) {
                            errorMessage += xhr.responseJSON.error;
                        }
                        $('#result').addClass('d-none');
                        $('#error').removeClass('d-none').text(errorMessage);
                    }
                });
            });

            // Add location change handler to automatically trigger form submission
            $('#location').on('change', function() {
                $('#cutoffForm').submit();
            });

            // Add smooth scrolling
            $(document).on('click', 'a[href^="#"]', function(e) {
                e.preventDefault();
                $('html, body').animate({
                    scrollTop: $($(this).attr('href')).offset().top
                }, 500);
            });

            // Remove category tooltip initialization
            $('#category').parent().find('label i.fa-info-circle').remove();

            // Update table class for mobile responsiveness
            $('#cutoffTable').closest('table').addClass('table-mobile');

            // Add data-label attributes to table cells for mobile view
            function updateTableForMobile() {
                const table = document.getElementById('cutoffTable');
                if (!table) return;
                
                const headers = Array.from(table.closest('table').querySelectorAll('thead th')).map(th => th.textContent);
                
                Array.from(table.querySelectorAll('tr')).forEach(row => {
                    Array.from(row.querySelectorAll('td')).forEach((cell, index) => {
                        cell.setAttribute('data-label', headers[index]);
                    });
                });
            }

            // Call updateTableForMobile whenever the table content changes
            const observer = new MutationObserver(updateTableForMobile);
            observer.observe(document.getElementById('cutoffTable'), { childList: true, subtree: true });

            // Initialize tooltips
            const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl);
            });

            // Initialize popovers
            const popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));
            popoverTriggerList.map(function (popoverTriggerEl) {
                return new bootstrap.Popover(popoverTriggerEl, {
                    trigger: 'hover focus'
                });
            });

            // Initialize location dropdown with Select2
            $('#location').select2({
                width: '100%',
                placeholder: 'Select Location',
                allowClear: true,
                templateResult: formatLocation,
                templateSelection: formatLocationSelection
            });

            function formatLocation(location) {
                if (!location.id) return location.text;
                return $(`<div class="d-flex align-items-center">
                    <span class="location-badge">${location.id}</span>
                    <span class="ms-2">${location.text}</span>
                </div>`);
            }

            function formatLocationSelection(location) {
                if (!location.id) return 'All Locations';
                return $(`<div class="d-flex align-items-center">
                    <span class="location-badge">${location.id}</span>
                    <span class="ms-1">${location.text}</span>
                </div>`);
            }
        });
    </script>
</body>
</html>
